<div class="admin-cell">
  <div class="admin-cell__infos" *ngIf="cell">
    <div class="admin-cell__title">
      <h1 class="title title--main">Cellule de {{ cell.name }}</h1>
    </div>

    <p>
      <b>Adresse : </b>
      {{ cell.address.address_line1 }},
      <span *ngIf="cell.address.address_line2">{{ cell.address.address_line2 }},</span>
      {{ cell.address.city }},
      {{ cell.address.postal_code }}
    </p>

    <p>
      <b>Courriel : </b>
      {{ cell.email }}
    </p>

    <p>
      <b>Manageur(s) : </b>
      <span *ngFor="let manager of cell.managers">
        {{ manager.first_name }}
      </span>
    </p>
  </div>
  <div class="admin-cell__buttons" *ngIf="cell">
    <button class="button button-op" (click)="export_link_pressed($event)" [disabled]="!this.nbVolunteerSelected">
      Télécharger la liste des Participations
    </button>

    <br><br>
    <button class="button button-op" (click)="openEmailForm($event)" [disabled]="!this.nbVolunteerSelected">
      Envoyer un courriel aux Participants
    </button><br><br>

    <p><i>Tu peux maintenant filtrer par cycle ou par activité pour modifier la liste des participants.</i></p>

  </div>

  <div class="admin-cell">
    <div class="admin-cell__actions__filters">
      <angular2-multiselect [data]="dropdownCycleList" [(ngModel)]="selectedCycles"
                            [settings]="dropdownCycleSettings"
                            (onSelect)="onItemSelect($event)"
                            (onDeSelect)="OnItemDeSelect($event)"
                            (onSelectAll)="onSelectAll($event)"
                            (onDeSelectAll)="onDeSelectAll($event)">
      </angular2-multiselect>
      <angular2-multiselect [data]="dropdownTasktypeList" [(ngModel)]="selectedTasktypes"
                            [settings]="dropdownTasktypeSettings"
                            (onSelect)="onItemSelect($event)"
                            (onDeSelect)="OnItemDeSelect($event)"
                            (onSelectAll)="onSelectAll($event)"
                            (onDeSelectAll)="onDeSelectAll($event)">
      </angular2-multiselect>
    </div>


    <app-my-table [settings]="settings"
                  [data]="eventsAdaptedFiltered"
                  (addButton)="openModalCreateEvent()"
                  (selectItem)="visitEvent($event)"
                  (editItem)="openModalEditEvent($event)"
                  class="admin-cell__table">
    </app-my-table>
  </div>
</div>

<app-my-modal name="custom_email"
              title="Envoyer un courriel"
              (button2)="sendEmail(emailForm)"
              button2Label="Envoyer"
              typeModal="form"
              >

    <div><b>Destinataire(s): {{ this.nbVolunteerSelected }} Participants</b></div>

    <div *ngIf="this.nbVolunteerSelected">
      <div *ngIf="this.selectedCycles.length == 0">
        Ceux qui sont actuellement inscrit
      </div>
      <div *ngIf="this.selectedCycles.length > 0">
        Ceux qui sont inscrit au(x) cycle(s) choisi:
      </div>
    </div>

    <div class="form-text form-text--left form-text--danger">
      <span *ngIf="this.nbVolunteerSelected == 0">Il n'y a pas de participants avec la/les sélection(s) actuelle(s).</span>
    </div>

    <angular2-multiselect [data]="dropdownCycleList" [(ngModel)]="selectedCycles"
                            [settings]="dropdownCycleSettings"
                            (onSelect)="onItemSelect($event)"
                            (onDeSelect)="OnItemDeSelect($event)"
                            (onSelectAll)="onSelectAll($event)"
                            (onDeSelectAll)="onDeSelectAll($event)">
    </angular2-multiselect>

    <div *ngIf="this.selectedTasktypes.length">
      <div>Parmis le(s) activité(s) : </div>
    </div>

    <angular2-multiselect [data]="dropdownTasktypeList" [(ngModel)]="selectedTasktypes"
                          [settings]="dropdownTasktypeSettings"
                          (onSelect)="onItemSelect($event)"
                          (onDeSelect)="OnItemDeSelect($event)"
                          (onSelectAll)="onSelectAll($event)"
                          (onDeSelectAll)="onDeSelectAll($event)">
    </angular2-multiselect>


    <br>

    <form [formGroup]="emailForm" *ngIf="emailForm">
      <div class="form-group">
        <label for="nbVolunteers" class="form-label" hidden>Nombre de destinataire(s):</label>
        <input class="input" formControlName="nbVolunteers" id="nbVolunteers" type="number" readonly hidden>
        <div class="form-text form-text--right form-text--danger" hidden>
             <span *ngIf="emailFormSubmitted && emailForm.controls.nbVolunteers.errors?.min">Il n'y a pas de participants avec la/les sélection(s) actuelle(s).</span>
        </div>
      </div>

      <div class="form-group">
        <label for="subject" class="form-label">Sujet du courriel:</label>
        <input class="input" formControlName="subject" id="subject" type="text" autofocus>
        <div class="form-text form-text--right form-text--danger">
             <span *ngIf="emailFormSubmitted && emailForm.controls.subject.errors?.required">Ce champ ne peut être nul.</span>
        </div>
      </div>

    <div class="form-group">
      <label for="content" class="form-label">Contenu:</label>
      <ckeditor
        id="content"
        class="input"
        formControlName="content"
        [editor]="Editor"
        [config]="{ toolbar: ['heading', '|', 'bold', 'italic', 'NumberedList', 'BulletedList', 'Link'] }"
      autofocus>
      </ckeditor>
      <div class="form-text form-text--right form-text--danger">
        <span *ngIf="emailFormSubmitted && emailForm.controls.content.errors?.required">Ce champ ne peut être nul.</span>
      </div>
    </div>
  </form>

</app-my-modal>

<app-my-modal name="event modal"
              [title]="modalTitle"
              [button2Label]="modalButton"
              (button2)="submitFormEvent()"
              typeModal="form"
              maxWidth="600px">

  <form [formGroup]="eventForm" *ngIf="eventForm">
    <div class="form-group">
      <label for="nb_volunteers_needed" class="form-label">Nombre de bénévoles requis:</label>
      <input class="input" formControlName="nb_volunteers_needed" id="nb_volunteers_needed" type="number" autofocus>
      <div class="form-text form-text--right form-text--danger"
           *ngFor="let errorMessage of eventForm.controls['nb_volunteers_needed'].getError('apiError')">
        {{ errorMessage}}
      </div>
    </div>

    <div class="form-group">
      <label for="nb_volunteers_standby_needed" class="form-label">Nombre de remplaçants requis:</label>
      <input class="input" formControlName="nb_volunteers_standby_needed" id="nb_volunteers_standby_needed" type="number" min="0">
      <div class="form-text form-text--right form-text--danger"
           *ngFor="let errorMessage of eventForm.controls['nb_volunteers_standby_needed'].getError('apiError')">
        {{ errorMessage}}
      </div>
    </div>

    <div class="form-group" *ngIf="tasktypes">
      <label for="task_type_id" class="form-label">Type d'activité:</label>
      <select formControlName="task_type_id" id="task_type_id" class="input input--select">
        <option value="" disabled>Choisis une activité</option>
        <option *ngFor="let taskType of tasktypes" [value]="taskType.id">{{ taskType.name }}</option>
      </select>
      <div class="form-text form-text--right form-text--danger"
           *ngFor="let errorMessage of eventForm.controls['task_type_id'].getError('apiError')">
        {{ errorMessage}}
      </div>
    </div>

    <div class="form-group" *ngIf="cycles">
      <label for="cycle_id" class="form-label">Cycle:</label>
      <select formControlName="cycle_id" id="cycle_id" class="input input--select" (change)="setSelectedCycle()">
        <option value="" disabled>Choisis un cycle</option>
        <option *ngFor="let cycle of cycles" [ngValue]="cycle.id">{{ cycle.name }}</option>
      </select>
      <div class="form-text form-text--right form-text--danger"
           *ngFor="let errorMessage of eventForm.controls['cycle_id'].getError('apiError')">
        {{ errorMessage}}
      </div>
    </div>

    <div class="form-group" *ngIf="selectedCycle">

      <label for="start_date" class="form-label">Début de la plage horaire:</label>
      <input [owlDateTimeTrigger]="dt12" [owlDateTime]="dt12"
             [min]="selectedCycle.start_date" [max]="selectedCycle.end_date"
             formControlName="start_date"  class="input"
             id="start_date">
      <owl-date-time #dt12 [firstDayOfWeek]="1"></owl-date-time>
      <div class="form-text form-text--right form-text--danger"
           *ngFor="let errorMessage of eventForm.controls['start_date'].getError('apiError')">
        {{ errorMessage}}
      </div>
    </div>

    <div class="form-group" *ngIf="selectedCycle">

      <label for="end_date" class="form-label">Fin de la plage horaire:</label>
      <input [owlDateTimeTrigger]="dt13" [owlDateTime]="dt13"
             [min]="selectedCycle.start_date" [max]="selectedCycle.end_date"
             formControlName="end_date" class="input"
             id="end_date">
      <owl-date-time #dt13 [firstDayOfWeek]="1" [startAt]="this.eventForm.controls['start_date'].value"></owl-date-time>
      <div class="form-text form-text--right form-text--danger"
           *ngFor="let errorMessage of eventForm.controls['end_date'].getError('apiError')">
        {{ errorMessage}}
      </div>
    </div>

    <div class="alert alert--danger" *ngIf="eventForm.hasError('apiError')">
      <div *ngFor="let error of eventForm.getError('apiError')">
        {{error}}
      </div>
    </div>

  </form>
</app-my-modal>
